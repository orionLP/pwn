<!DOCTYPE html>
<html>
    <head>
        <title>Nmap walkthrough</title>
    </head>
    <body>
        <h1>Nmap room</h1>
        <hr>
        
        <nav>
            <ol>
                <li>
                    <a href="#options">Options</a>
                </li>
                <li>
                    <a href="#port states">Port states</a>
                </li>
                <li>
                    <a href="#scan types">Types of scan</a>
                </li>
                <li>
                    <a href="#others">Others</a>
                </li>
                <li>
                    <a href="#firewall evasion">Firewall evasion</a>
                </li>
                <li>
                    <a href="#machine">Machine</a>
                </li>
            </ol>
        </nav>

        <section id="options">
            <h2>Question 1</h2>
            <p>
                Given the following intentions, which switches do we have to use?
            </p>

            <ul>
                <li>
                    <p>
                        Enable sys scan: -sS    
                    </p>
                </li>
                <li>
                    <p>
                        Perform an udp scan: -sU
                    </p>
                </li>
                <li>
                    <p>
                        Detect the user's operating system: -O
                    </p>
                </li>
                <li>
                    <p>
                        The versions of the services running on the target: -sV
                    </p>
                </li>
                <li>
                    <p>
                        To change verbosity level: -v for level 1, -vv for level 2
                    </p>
                </li>
                <li>
                    <p>
                        Save results in a greapable format: -oG
                    </p>
                </li>
                <li>
                    <p>
                        Aggressive mode enables OS detection, version detection, script scanning, and traceroute: -A
                    </p>
                </li>
                <li>
                    <p>
                        Nmap can reduce the time it takes to do scans using the template option: -T0-5 
                        <br>
                        <strong> 
                            Note: The number after the T is the speed, 0 is the slowest and 5 is the fastest, and 
                            usually, detection is easier when using high numbers 
                        </strong>
                    </p>
                </li>
                <li>
                    <p>
                        To scan a range of ports use the: -p <i>range</i>
                    </p>
                </li>
                <li>
                    <p>
                        To activate a script from the nmap scripting library: --script=<i>script_name</i>
                    </p>
                </li>
            </ul>
        </section> 

        <section id="port states">
            <h2>
                Port states
            </h2>

            <ul>
                <li>
                    <p>
                        <strong>Open</strong>: The port is open and is accepting connections. (this means a SYN-ACK packet was recieved)
                    </p>
                </li>
                <li>
                    <p>
                        <strong>Closed</strong>: The port is closed and is not accepting connections. (this means a RST packet was recieved)
                    </p>
                </li>
                <li>
                    <p>
                        <strong>Filtered</strong>: The port is filtered and is dropping packets. (this means no response was recieved, most likely 
                        due to a firewall dropping the packets).
                    </p>
                </li>
                <li>
                    <p>
                        <strong>
                            Open|Filtered
                        </strong>
                        : Most common in UDP scans it means the port could either be open or closed (and nmap could not differenciate between the two of them).
                    </p>
                </li>
            </ul>
        </section>

        <section id="scan types">
            <h2>
                Types of scans in nmap
            </h2>

            <ul>
                <li>
                    <p>
                        <strong>TCP scan</strong>:
                        The scan works by initiating a TCP handshake sending a sync packet to the target. If the target responds with a sync-ack packet, the port is open.
                        If instead the target responds with a RST packet, the port is closed. If there is no response, we assume the target is dropping the packets, probably 
                        due to firewall rules or the port is filtered. This is the most easy to defend against, since the target only needs respond with a RST packet to 
                        seem like a closed port. It is also worth noting that in this scan, we will send an ack packet.
                    </p>
                </li>
                <li>
                    <p>
                        <strong>SYN scan</strong>:
                        This is the same as a TCP scan, but instead of sending an ACK packet, we will send back a 
                        RST packet, so we do not waste time, and the server does not send more SYN-ACK packets 
                        trying to reach us. Some applications will not log connections until they recieve an ACK packet,
                        but it might break unstable applications.
                    </p>
                </li>
                <li>
                    <p>
                        <strong>UDP scans</strong>:
                        UDP is a stateless protocol, so no information is recieved back by a udp server even if it is open. This makes udp scans much more challenging.
                        To this end, nmap will categorize a port as open|filtered if it does not recieve a response, as it could be behind a firewall or be open. If it does 
                        recieve a response, it will categorize it as open. If a UDP port is closed then the server should respond with a ICMP message stating that the port is closed.

                        <br>

                        This also makes scans much more hard and time consuming. Therefore, a trick is to use nmap <i>-sU --top-ports 20</i> to only search the 20 most common UDP ports.
                    </p>
                </li>

                <li>
                    <p>

                        There is also the <strong>Xmas</strong>, <strong>NULL</strong> and <strong>FIN</strong> scans, which all rely on sending malformed packets to bypass security firewalls.
                        Fow now i will not go into detail about them, but they are worth mentioning (specially once i get to harder machines which need this sorts of scans).
                    </p>
                </li>
            </ul>
        </section>

        <section id="firewall evasion">
            <h2>
                Simple techniques for firewall evasion.
            </h2>
            <ul>
                <li>
                    <p>
                        A thing nmap does before any scanning is to send ICMP packet to try to see if the host is up. 
                        Some firewalls will simply not allow ICMP packets to pass, and so nmap will consider the host down. 
                        To avoid this use the <i>-Pn</i> switch to skip the host discovery phase not bothering to see if the host is up.
                        (nmap can also ARP packets to determine if the host is up).
                    </p>
                </li>
                <li>
                    <p>
                        Some firewalls are configured to simply let pass fragmented packets, since processing them costs lots of cpu and network 
                        resources (most firewalls work at packet level, inspecting headers and payloads). To take advantage of this, nmap can send fragmented packets using the <i>-f</i> switch
                        or the -mtu <i>number</i> switch to specify the maximum transmission unit of the packets (must be multiple of 8).
                    </p>
                </li>
                <li>
                    <p>
                        Some firewalls implement time based rules, and we can manipulate that by using the --scan-delay &lt;time&gt; switch to specify the time between packets.
                    </p>
                </li>
                <li>
                    <p>
                        A useful thing is to determine the presence of absence of a firewall. For example, if you can reach the a port using a scan technique, but then when sending a 
                        packet with the --badsum flag enabled (which makes the checksum be wrong). Any TCP/IP stack will drop this, but some firewalls might not check for it and respond authomatically.
                        Thus you can determine their presence.
                    </p>
                </li>
            </ul>
        </section>
        
        <section id="machine">

        </section>
        <hr>
        <section id="others">
            <h4>Others</h4>
            <address>
                <a href="https://github.com/orionLP/pwn">GitHub repository</a>
            </address>
        </section>
    </body>
</html>